!function(){function a(angular){var a=function(){function a(){}return a.COMMAND_IDS="ids",a.COMMAND_CREATE="create",a.COMMAND_READ="read",a.COMMAND_UPDATE="update",a.COMMAND_DELETE="delete",a.COMMAND_VERSION="version",a.COMMAND_CHANGES="changes",a.CONFIGURATION="streamsConfiguration",a.UPDATE_DELETED=1,a.UPDATE_CREATED=2,a.UPDATE_CHANGED=3,a}(),b=angular.module("streams-client",[]);b.constant(a.CONFIGURATION,{ConnectionPath:"streams"});var c=function(){function b(a,b,c){this.httpService=a,this.qService=b,this.configuration=c}return b.prototype.sendRequests=function(a){return this.httpService.post("/"+this.configuration.ConnectionPath,a)},b.prototype.getIds=function(b,c,d,e){var f=this;return this.sendRequests([{command:a.COMMAND_IDS,nodeId:c,filter:d,options:e,streamId:b}]).then(function(a){return a.data&&1===a.data.length&&a.data[0].ids?a.data[0].ids:f.qService.reject()})},b.prototype.readRecord=function(b,c,d){var e=this;return this.sendRequests([{command:a.COMMAND_READ,id:d,nodeId:c,streamId:b}]).then(function(a){return a.data&&1===a.data.length?a.data[0].record:e.qService.reject()})},b.prototype.readRecords=function(b,c,d){for(var e=[],f=0;f<d.length;f++)e.push({command:a.COMMAND_READ,id:d[f],nodeId:c,streamId:b});return this.sendRequests(e).then(function(a){for(var b=[],c=0;c<a.data.length;c++)a.data[c].record&&b.push(a.data[c].record);return b})},b.prototype.updateRecord=function(b,c,d,e){var f=this;return this.sendRequests([{command:a.COMMAND_UPDATE,record:d,nodeId:c,echo:e,streamId:b}]).then(function(a){return a.data&&1===a.data.length&&a.data[0].record?a.data[0].record:f.qService.reject()})},b.prototype.createRecord=function(b,c,d){var e=this;return this.sendRequests([{command:a.COMMAND_CREATE,record:d,nodeId:c,streamId:b}]).then(function(a){return a.data&&1===a.data.length||a.data[0].record?a.data[0].record:e.qService.reject()})},b.prototype.deleteRecord=function(b,c,d){var e=this;return this.sendRequests([{command:a.COMMAND_DELETE,id:d,nodeId:c,streamId:b}]).then(function(a){return a.data&&1===a.data.length?void 0:e.qService.reject()})},b.prototype.getVersion=function(b,c){var d=this;return this.sendRequests([{command:a.COMMAND_VERSION,streamId:b,nodeId:c}]).then(function(a){return a.data&&1===a.data.length?a.data[0].version:d.qService.reject()})},b.prototype.getOneStreamChanges=function(b,c,d){var e=this;return this.sendRequests([{command:a.COMMAND_CHANGES,version:d,streamId:b,nodeId:c}]).then(function(a){return a.data&&1===a.data.length?a.data[0].changes:e.qService.reject()})},b.prototype.getManyStreamsChanges=function(b){for(var c=this,d=[],e=0;e<b.length;e++)d.push({command:a.COMMAND_CHANGES,version:b[e].version,streamId:b[e].streamId,nodeId:b[e].nodeId});return this.sendRequests(d).then(function(a){if(!a.data)return c.qService.reject();for(var b=[],d=0;d<a.data.length;d++)b.push({streamId:a.data[d].streamId,updates:a.data[d].changes,nodeId:a.data[d].nodeId});return b})},b}();b.service("streamsCommunication",["$http","$q",a.CONFIGURATION,c]);var d=function(){function a(a,b,c,d,e,f){this.storage=a,this.instanceId=b,this.streamId=c,this.nodeId=d,this.communicationService=f,this.version=e,this.listeners=[]}return a.prototype.getStreamId=function(){return this.streamId},a.prototype.getVersion=function(){return this.version},a.prototype.getNodeId=function(){return this.nodeId},a.prototype.onUpdate=function(a,b,c){if(!(c<this.version)){this.version=c;for(var d=0;d<this.listeners.length;d++)this.listeners[d].onChange(a,b)}},a.prototype.initialize=function(){var a=this;return this.version?new Promise(function(a){a()}):this.communicationService.getVersion(this.streamId,this.nodeId).then(function(b){a.version=b})},a.prototype.addListener=function(a){this.listeners.push(a)},a.prototype.removeListener=function(a){for(var b=0;b<this.listeners.length;b++)if(this.listeners[b]===a){this.listeners.splice(b,1);break}},a.prototype.close=function(){this.storage.close(this.instanceId)},a.prototype.getIds=function(a,b){return this.communicationService.getIds(this.streamId,this.nodeId,a,b)},a.prototype.read=function(a){return this.communicationService.readRecord(this.streamId,this.nodeId,a)},a.prototype.readMany=function(a){return this.communicationService.readRecords(this.streamId,this.nodeId,a)},a.prototype.update=function(a,b){return this.communicationService.updateRecord(this.streamId,this.nodeId,a,b)},a.prototype.create=function(a,b){return this.communicationService.createRecord(this.streamId,this.nodeId,a,b)},a.prototype.remove=function(a){return this.communicationService.deleteRecord(this.streamId,this.nodeId,a)},a}(),e=(function(){function a(a){this.communicationService=a,this.tempCounter=0,this.channels={}}return a.prototype.get=function(a,b){this.tempCounter++;for(var c=this.tempCounter.toString(),e=Object.keys(this.channels),f=null,g=0;g<e.length;g++){var h=this.channels[e[g]];if(h.getNodeId()===b&&h.getStreamId()===a){f=h.getVersion();break}}var i=new d(this,c,a,b,f,this.communicationService);return this.channels[c]=i,new Promise(function(a){i.initialize().then(function(){a(i)})})},a.prototype.close=function(a){delete this.channels[a]},a.prototype.checkForUpdates=function(){for(var a=[],b=Object.keys(this.channels),c={},d=0;d<b.length;d++){var e=this.channels[b[d]],f={streamId:e.getStreamId(),version:e.getVersion(),nodeId:e.getNodeId()},g=f.streamId+":"+f.nodeId;c[g]||(c[g]=[],a.push(f)),c[g].push(e)}return this.communicationService.getManyStreamsChanges(a).then(function(a){for(var b=0;b<a.length;b++){var d=a[b],e=d.streamId+":"+d.nodeId,f=c[e];if(f)for(var g=0;g<d.updates.length;g++)for(var h=d.updates[g],i=0;i<f.length;i++)f[i].onUpdate(h.type,h.id,h.version)}})},a}(),function(){function a(a,b){this.qService=a,this.communicationService=b}return a.prototype.getObject=function(a){return void 0},a.prototype.getTree=function(a){return void 0},a.prototype.getArray=function(a,b){return void 0},a.prototype.streamClosed=function(a){},a}());b.service("streamsDataStructures",["$q","streamsCommunication",e]);(function(){function a(a,b){this.service=a,this.streamId=b}return a.prototype.onUpdate=function(a){},a.prototype.push=function(a){},a.prototype.get=function(a){return void 0},a.prototype.set=function(a,b){},a.prototype.getReadOnlyArray=function(){return void 0},a.prototype.destroy=function(){this.service.streamClosed(this.streamId)},a.prototype.remove=function(a){},a})(),function(){function b(a){this.dataChannel=a,this.dataChannel.addListener(this),this.innerObject={}}return b.prototype.initialize=function(){var a=this;return this.dataChannel.getIds().then(function(b){return b.length?a.dataChannel.readMany(b).then(function(b){for(var c=0;c<b.length;c++)a.innerObject[b[c].id]=b[c].value}):void 0})},b.prototype.onChange=function(b,c){var d=this;switch(b){case a.UPDATE_CHANGED:case a.UPDATE_CREATED:return this.dataChannel.read(c).then(function(a){d.innerObject[a.id]=a.value});case a.UPDATE_DELETED:delete this.innerObject[c]}return new Promise(function(a){a()})},b.prototype.getKeys=function(){var a=this;return new Promise(function(b){b(Object.keys(a.innerObject))})},b.prototype.get=function(a){var b=this;return new Promise(function(c){c(b.innerObject[a])})},b.prototype.set=function(a,b){var c=this.innerObject[a];this.innerObject[a]=b;var d={id:a,value:b};return c?this.dataChannel.update(d,!1).then(function(){}):this.dataChannel.create(d,!1).then(function(){})},b.prototype.remove=function(a){return delete this.innerObject[a],this.dataChannel.remove(a)},b.prototype.getReadOnlyObject=function(){return this.innerObject},b.prototype.destroy=function(){this.dataChannel.removeListener(this),this.dataChannel.close()},b}()}if("function"==typeof define&&define.amd)define(["angular","angular.animate","angular.translate","angular.messages","angular.material","angular.aria","angular.touch"],function(b,c,d,e,f,g,h){a(b)});else if("object"==typeof exports){var b=require("angular");require("angular.animate"),require("angular.translate"),require("angular.messages"),require("angular.material"),require("angular.aria"),require("angular.touch"),module.exports=a(b)}else a(window.angular)}();